class e extends Event{sourceEvent;constructor(e,t){super("hx-request",{bubbles:!0,composed:t}),this.sourceEvent=e}}function t(t){let r=function(e){if(!(e.target instanceof Element))return;if(!e.target.getAttribute("hx-placement"))return;if(e.target instanceof HTMLFormElement)return e.target;let t=e.target;for(;t&&t!==e.currentTarget;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}}(t);if(r){t.preventDefault();let n=null!==r.getAttribute("hx-composed");r.dispatchEvent(new e(t,n))}}class r extends Event{sourceEvent;response;error;constructor(e){super("hx-response",{bubbles:!0,composed:e.composed}),this.sourceEvent=e}}async function n(t,n){if(!(t.target instanceof Element))return;if(!t.target.getAttribute("hx-placement"))return;let s=function(t){if(!(t instanceof e))return;if(t.target instanceof HTMLAnchorElement)return new Request(t.target.href);if(t.target instanceof HTMLFormElement){let e;return t.sourceEvent instanceof SubmitEvent&&(e=t.sourceEvent.submitter),new Request(t.target.action,{method:t.target.getAttribute("method")||"get",body:new FormData(t.target,e)})}}(t);if(!s)return;let o=new r(t);try{o.response=await fetch(s,{signal:n.getSignals()})}catch(e){o.error=e}n.abort(),t.target.dispatchEvent(o)}class s{#e=[];#t=[];#r;enqueue(e){this.#e.push(e),this.#r||this.#n()}async#n(){if(!this.#t.length){let e;for(;e=this.#e.pop();)this.#t.push(e)}this.#r=this.#t.pop(),void 0!==this.#r&&(await this.#r,this.#n())}}class o{#s;#o;#i;#a;constructor(e,t){this.#i=e,this.#a=performance.now(),this.#s=new AbortController,this.#o=AbortSignal.timeout(t)}get aborted(){return this.#s.signal.aborted||this.#o.aborted}throttle(){performance.now()-this.#a>this.#i&&this.abort()}abort(){this.#s.abort()}getSignals(){return AbortSignal.any([this.#s.signal,this.#o])}}class i{#c=new WeakMap;set(e){if(!(e instanceof Element))return;let t=this.#c.get(e);if(t&&(t.throttle(),!t.aborted))return;let r=parseFloat(e.getAttribute("hx-throttle"));Number.isNaN(r)&&(r=0);let n=parseFloat(e.getAttribute("hx-timeout"));return Number.isNaN(n)&&(n=5e3),t=new o(r,n),this.#c.set(e,t),t}}class a extends Event{sourceEvent;node;fragment;error;constructor(e){super("hx-project",{bubbles:!0,composed:e.composed}),this.sourceEvent=e}}class c extends Error{constructor(e){super(),this.message=e}}async function u(e){if(!(e instanceof r)||e.error||!e.response)return;if(!(e.target instanceof HTMLAnchorElement||e.target instanceof HTMLFormElement))return;const t=await e.response.text();queueMicrotask((function(){const r=new a(e);try{r.node=function(e){if(!(e.target instanceof Element&&e.currentTarget instanceof Element))return;const t=e.target.getAttribute("target")||"_currentTarget";return"_target"===t?e.target:"_currentTarget"===t?e.currentTarget:"_document"===t?document:e.currentTarget.querySelector(t)}(e),r.node&&(r.fragment=function(e,t){let r=e.headers.get("content-type");if("text/html; charset=utf-8"!==r)throw new c(`unexpected content-type: ${r}`);const n=document.createElement("template");return n.innerHTML=t,n.content.cloneNode(!0)}(e.response,t)),r.fragment&&function(e,t,r){if(!(e.target instanceof Element))return;const n=e.target.getAttribute("hx-placement");if("none"===n)return t;if("start"===n)return r.insertBefore(t,t.firstChild);if("end"===n)return t.appendChild(r);const s=t.parentElement;if(s){if("replace"===n)return s.replaceChild(r,t);if("remove"===n)return s.removeChild(t);if("before"===n)return r.insertBefore(s,t);if("after"===n)return r.insertBefore(s,t.nextSibling)}if(t instanceof Element){if("remove_children"===n)return t.replaceChildren(),t;if("replace_children"===n)return t.replaceChildren(r),t}throw new c("unknown hx-placement attribute")}(e,r.node,r.fragment)}catch(e){r.error=e}e.target.dispatchEvent(r)}))}function l(e,r,n){e.addEventListener("pointerup",t),e.addEventListener("keydown",t),e.addEventListener("submit",t),e.addEventListener("hx-request",r),e.addEventListener("hx-response",n)}function h(e,r,n){e.removeEventListener("pointerup",t),e.removeEventListener("keydown",t),e.removeEventListener("submit",t),e.removeEventListener("hx-request",r),e.addEventListener("hx-response",n)}const f=new class{#u=new s;#l=new i;constructor(){this.onHxRequest=this.onHxRequest.bind(this)}onHxRequest(e){let t=this.#l.set(e.target);t&&this.#u.enqueue(n(e,t))}},d=new class{#u=new s;constructor(){this.onHxResponse=this.onHxResponse.bind(this)}onHxResponse(e){let t=u(e);t&&this.#u.enqueue(t)}};l(document,f.onHxRequest,d.onHxResponse);export{l as connect,h as disconnect};
