class e extends Event{sourceEvent;constructor(e){super("hx-request",{bubbles:!0}),this.sourceEvent=e}}function t(t){let n=function(e){if(!(e.target instanceof Element))return;if(!e.target.getAttribute("hx-placement"))return;if(e.target instanceof HTMLFormElement)return e.target;let t=e.target;for(;t&&t!==e.currentTarget;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}}(t);n&&(t.preventDefault(),n.dispatchEvent(new e(t)))}class n{#e=[];#t=[];#n;enqueue(e){void 0!==e&&(this.#e.push(e),this.#n||this.#r())}async#r(){if(!this.#t.length){let e;for(;e=this.#e.pop();)this.#t.push(e)}this.#n=this.#t.pop(),void 0!==this.#n&&(await this.#n,this.#r())}}class r extends Event{sourceEvent;request;response;text;node;error;constructor(e,t,n,r,s,o,i){super(e,{bubbles:!0}),this.sourceEvent=t,this.request=n,this.response=r,this.text=s,this.node=o,this.error=i}}async function s(t){let n=function(t){if(!(t instanceof e))return;if(t.target instanceof HTMLAnchorElement)return new Request(t.target.href);if(t.target instanceof HTMLFormElement){const e=t.target.getAttribute("method")??"get";let n;t.sourceEvent instanceof SubmitEvent&&(n=t.sourceEvent.submitter);const r=new FormData(t.target,n);return new Request(t.target.action,{method:e,body:r})}}(t);if(!n)return;if(!(t.target instanceof Element))return;const s=t.target.getAttribute("target"),o=t.target.getAttribute("hx-placement");if(!s||!o)return;let i,a;try{i=await fetch(n),a=await i.text()}catch(e){return void t.target.dispatchEvent(new r("hx-request-error",t,n,i,a,void 0,e))}!function(e,t,n,s,o,i){queueMicrotask((function(){if(!(e.target instanceof HTMLElement&&e.currentTarget instanceof HTMLElement))return;let a,c,u;try{let t;if("_target"===o&&(t=e.target),"_currentTarget"===o&&(t=e.currentTarget),t||(t=e.currentTarget.querySelector(o)),!(t instanceof Node))return;c=function(e){const t=document.createElement("template");return t.innerHTML=e,t.content.cloneNode(!0)}(s),"none"===i&&(u=t),"start"===i&&(u=c.insertBefore(t,t.firstChild)),"end"===i&&(u=t.appendChild(c));const n=t.parentElement;n&&("replace"===i&&(u=n.replaceChild(c,t)),"remove"===i&&(u=n.removeChild(t)),"before"===i&&(u=c.insertBefore(n,t)),"after"===i&&(u=c.insertBefore(n,t.nextSibling))),u||(a=new Error("hx-response error - placement failed"))}catch(e){a=e}let h=a?"hx-response-error":"hx-response-success";e.target.dispatchEvent(new r(h,e,t,n,s,c,a))}))}(t,n,i,a,s,o)}function o(e,n){e.addEventListener("pointerup",t),e.addEventListener("keydown",t),e.addEventListener("submit",t),e.addEventListener("hx-request",n)}function i(e,n){e.removeEventListener("pointerup",t),e.removeEventListener("keydown",t),e.removeEventListener("submit",t),e.removeEventListener("hx-request",n)}const a=new class{#s=new n;constructor(){this.onHxRequest=this.onHxRequest.bind(this)}onHxRequest(e){let t=s(e);t&&this.#s.enqueue(t)}};o(document,a.onHxRequest);export{o as connect,i as disconnect,a as hx};
