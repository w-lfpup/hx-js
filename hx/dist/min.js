class e extends Event{sourceEvent;constructor(e){super("hx-request",{bubbles:!0}),this.sourceEvent=e}}function t(t){let n=function(e){if(!(e.target instanceof Element))return;if(null===e.target.getAttribute("hx-placement"))return;if(e.target instanceof HTMLFormElement)return e.target;let t=e.target;for(;t&&t!==e.currentTarget;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}}(t);n&&(t.preventDefault(),n.dispatchEvent(new e(t)))}class n{#e=[];#t=[];#n;enqueue(e){e instanceof Object&&(this.#e.push(e),this.#n||this.#r())}async#r(){if(!this.#t.length){let e;for(;e=this.#e.pop();)this.#t.push(e)}this.#n=this.#t.pop(),void 0!==this.#n&&(await this.#n,this.#r())}}class r extends Event{sourceEvent;response;error;constructor(e){super("hx-response",{bubbles:!0}),this.sourceEvent=e}}async function s(t,n){if(!(t.target instanceof Element))return;if(null===t.target.getAttribute("hx-placement"))return;let s=function(t){if(!(t instanceof e))return;if(t.target instanceof HTMLAnchorElement)return new Request(t.target.href);if(t.target instanceof HTMLFormElement){let e=t.sourceEvent instanceof SubmitEvent?t.sourceEvent.submitter:void 0;return new Request(t.target.action,{method:t.target.getAttribute("method")||"get",body:new FormData(t.target,e)})}}(t);if(!s)return;let o=new r(t);try{o.response=await fetch(s,{signal:n.getSignals()})}catch(e){o.error=e}t.target.dispatchEvent(o)}class o{#s;#o;createdAt;timeout;aborted;constructor(e){this.createdAt(performance.now()),this.timeout=e,this.#s=new AbortController,this.#o=AbortSignal.any([this.#s.signal,AbortSignal.timeout(e)])}abort(){this.#s.abort(),this.aborted=!0}getSignals(){return this.#o}}class a{#a=new WeakMap;set(e){if(!(e instanceof Element))return;let t=this.#a.get(e);if(t&&!t.aborted){if(performance.now()-t.createdAt<t.timeout)return;t.abort()}let n=e.getAttribute("hx-timeout"),r=parseFloat(n);return Number.isNaN(r)&&(r=5e3),t=new o(r),this.#a.set(e,t),t}}const i=new Set(["none"]);class c extends Event{sourceEvent;node;fragment;error;constructor(e){super("hx-project",{bubbles:!0}),this.sourceEvent=e}}async function u(e){if(!(e instanceof r))return;if(!(e.target instanceof HTMLElement))return;if(!e.response)return;const t=await e.response.text();queueMicrotask((function(){if(!(e.target instanceof HTMLElement&&e.currentTarget instanceof HTMLElement))return;const n=e.target.getAttribute("hx-placement");if(i.has(n))return;const r=e.target.getAttribute("target")||"_currentTarget";let s;"_target"===r&&(s=e.target),"_currentTarget"===r&&(s=e.currentTarget),"_document"===r&&(s=document);const o=new c(e);try{if(s||(s=e.currentTarget.querySelector(r)),s instanceof Node&&(o.fragment=function(e,t){const n=document.createElement("template");return n.innerHTML=t,n.content.cloneNode(!0)}(e.response,t)),o.fragment){"start"===n&&o.fragment.insertBefore(s,s.firstChild),"end"===n&&s.appendChild(o.fragment);const e=s.parentElement;e&&("replace"===n&&e.replaceChild(o.fragment,s),"remove"===n&&e.removeChild(s),"before"===n&&o.fragment.insertBefore(e,s),"after"===n&&o.fragment.insertBefore(e,s.nextSibling))}}catch(e){o.error=e}e.target.dispatchEvent(o)}))}function l(e,n,r){e.addEventListener("pointerup",t),e.addEventListener("keydown",t),e.addEventListener("submit",t),e.addEventListener("hx-request",n),e.addEventListener("hx-response",r)}function h(e,n,r){e.removeEventListener("pointerup",t),e.removeEventListener("keydown",t),e.removeEventListener("submit",t),e.removeEventListener("hx-request",n),e.addEventListener("hx-response",r)}const f=new class{#i=new n;#c=new a;constructor(){this.onHxRequest=this.onHxRequest.bind(this)}onHxRequest(e){let t=this.#c.set(e.target);t&&this.#i.enqueue(s(e,t))}},g=new class{#i=new n;constructor(){this.onHxResponse=this.onHxResponse.bind(this)}onHxResponse(e){let t=u(e);t&&this.#i.enqueue(t)}};l(document,f.onHxRequest,g.onHxResponse);export{l as connect,h as disconnect,f as hx};
