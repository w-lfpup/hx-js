class e extends Event{sourceEvent;constructor(e,t){super("hx-request",{bubbles:!0,composed:t}),this.sourceEvent=e}}function t(t){let r=function(e){if(!(e.target instanceof Element))return;if(!e.target.getAttribute("hx-placement"))return;if(e.target instanceof HTMLFormElement)return e.target;let t=e.target;for(;t&&t!==e.currentTarget;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}}(t);if(r){t.preventDefault();let n=null!==r.getAttribute("composed");r.dispatchEvent(new e(t,n))}}class r{#e=[];#t=[];#r;enqueue(e){this.#e.push(e),this.#r||this.#n()}async#n(){if(!this.#t.length){let e;for(;e=this.#e.pop();)this.#t.push(e)}this.#r=this.#t.pop(),void 0!==this.#r&&(await this.#r,this.#n())}}class n extends Event{sourceEvent;response;error;constructor(e){super("hx-response",{bubbles:!0,composed:e.composed}),this.sourceEvent=e}}async function s(t,r){if(!(t.target instanceof Element))return;if(!t.target.getAttribute("hx-placement"))return;let s=function(t){if(!(t instanceof e))return;if(t.target instanceof HTMLAnchorElement)return new Request(t.target.href);if(t.target instanceof HTMLFormElement){let e;return t.sourceEvent instanceof SubmitEvent&&(e=t.sourceEvent.submitter),new Request(t.target.action,{method:t.target.getAttribute("method")||"get",body:new FormData(t.target,e)})}}(t);if(!s)return;let o=new n(t);try{o.response=await fetch(s,{signal:r.getSignals()})}catch(e){o.error=e}r.abort(),t.target.dispatchEvent(o)}class o{#s;#o;constructor(e){this.#s=new AbortController,this.#o=AbortSignal.timeout(e)}abort(){this.#s.abort()}isAborted(){return this.#s.signal.aborted||this.#o.aborted}getSignals(){return AbortSignal.any([this.#s.signal,this.#o])}}class i{#i=new WeakMap;set(e){if(!(e instanceof Element))return;let t=this.#i.get(e);if(t&&!t.isAborted())return;let r=parseFloat(e.getAttribute("hx-timeout"));return Number.isNaN(r)&&(r=5e3),t=new o(r),this.#i.set(e,t),t}}class a extends Event{sourceEvent;node;fragment;error;constructor(e){super("hx-project",{bubbles:!0,composed:e.composed}),this.sourceEvent=e}}async function c(e){if(!(e instanceof n)||e.error||!e.response)return;const t=await e.response.text();queueMicrotask((function(){const r=new a(e);try{r.node=function(e){if(!(e.target instanceof Element&&e.currentTarget instanceof Element))return;const t=e.target.getAttribute("target")||"_currentTarget";return"_target"===t?e.target:"_currentTarget"===t?e.currentTarget:"_document"===t?document:e.currentTarget.querySelector(t)}(e),r.node&&(r.fragment=function(e,t){if(e.status>=200&&e.status<300)return;if("text/html; charset=utf-8"!==e.headers.get("content-type"))return;const r=document.createElement("template");return r.innerHTML=t,r.content.cloneNode(!0)}(e.response,t)),r.fragment&&function(e,t,r){if(!(e.target instanceof Element))return;const n=e.target.getAttribute("hx-placement");switch(n){case"none":return t;case"start":return r.insertBefore(t,t.firstChild);case"end":return t.appendChild(r)}const s=t.parentElement;if(s)switch(n){case"replace":return s.replaceChild(r,t);case"remove":return s.removeChild(t);case"before":return r.insertBefore(s,t);case"after":return r.insertBefore(s,t.nextSibling)}throw new Error("hx projection failed")}(e,r.node,r.fragment)}catch(e){r.error=e}e.target.dispatchEvent(r)}))}function u(e,r,n){e.addEventListener("pointerup",t),e.addEventListener("keydown",t),e.addEventListener("submit",t),e.addEventListener("hx-request",r),e.addEventListener("hx-response",n)}function l(e,r,n){e.removeEventListener("pointerup",t),e.removeEventListener("keydown",t),e.removeEventListener("submit",t),e.removeEventListener("hx-request",r),e.addEventListener("hx-response",n)}const h=new class{#a=new r;#c=new i;constructor(){this.onHxRequest=this.onHxRequest.bind(this)}onHxRequest(e){let t=this.#c.set(e.target);t&&this.#a.enqueue(s(e,t))}},f=new class{#a=new r;constructor(){this.onHxResponse=this.onHxResponse.bind(this)}onHxResponse(e){let t=c(e);t&&this.#a.enqueue(t)}};u(document,h.onHxRequest,f.onHxResponse);export{u as connect,l as disconnect,h as hx};
