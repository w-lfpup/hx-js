class e extends Event{sourceEvent;constructor(e){super("hx-request",{bubbles:!0}),this.sourceEvent=e}}function t(t){let n=function(e){if(!(e.target instanceof Element))return;if(!e.target.getAttribute("hx-placement"))return;if(e.target instanceof HTMLFormElement)return e.target;let t=e.target;for(;t&&t!==e.currentTarget;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}}(t);n&&(t.preventDefault(),n.dispatchEvent(new e(t)))}class n{#e=[];#t=[];#n;enqueue(e){void 0!==e&&(this.#e.push(e),this.#n||this.#r())}async#r(){if(!this.#t.length){let e;for(;e=this.#e.pop();)this.#t.push(e)}this.#n=this.#t.pop(),void 0!==this.#n&&(await this.#n,this.#r())}}class r{request;response;text;node;error}class s extends Event{sourceEvent;details;constructor(e,t,n){super(e,{bubbles:!0}),this.sourceEvent=t,this.details=n}}async function o(t){if(!(t.target instanceof Element))return;let n=function(t){if(!(t instanceof e))return;if(t.target instanceof HTMLAnchorElement)return new Request(t.target.href);if(t.target instanceof HTMLFormElement){let e=t.sourceEvent instanceof SubmitEvent?t.sourceEvent.submitter:void 0;return new Request(t.target.action,{method:t.target.getAttribute("method")||"get",body:new FormData(t.target,e)})}}(t);if(!n)return;const o=t.target.getAttribute("target"),i=t.target.getAttribute("hx-placement");if(!o||!i)return;let a=new r;a.request=n;try{a.response=await fetch(n),a.text=await a.response.text()}catch(e){a.error=e}if(a.error||a.response&&a.response.status>=500)return t.target.dispatchEvent(new s("hx-request-error",t,a));!function(e,t,n,r){queueMicrotask((function(){if(!(e.target instanceof HTMLElement&&e.currentTarget instanceof HTMLElement))return;let o;try{let s;if("_target"===n&&(s=e.target),"_currentTarget"===n&&(s=e.currentTarget),"_document"===n&&(s=document),s||(s=e.currentTarget.querySelector(n)),s instanceof Node){t.node=function(e){const t=document.createElement("template");return t.innerHTML=e,t.content.cloneNode(!0)}(t.text),"none"===r&&(o=s),"start"===r&&(o=t.node.insertBefore(s,s.firstChild)),"end"===r&&(o=s.appendChild(t.node));const e=s.parentElement;e&&("replace"===r&&(o=e.replaceChild(t.node,s)),"remove"===r&&(o=e.removeChild(s)),"before"===r&&(o=t.node.insertBefore(e,s)),"after"===r&&(o=t.node.insertBefore(e,s.nextSibling)))}}catch(e){t.error=e}let i=t.error||!o?"hx-response-error":"hx-response";e.target.dispatchEvent(new s(i,e,t))}))}(t,a,o,i)}function i(e,n){e.addEventListener("pointerup",t),e.addEventListener("keydown",t),e.addEventListener("submit",t),e.addEventListener("hx-request",n)}function a(e,n){e.removeEventListener("pointerup",t),e.removeEventListener("keydown",t),e.removeEventListener("submit",t),e.removeEventListener("hx-request",n)}const u=new class{#s=new n;constructor(){this.onHxRequest=this.onHxRequest.bind(this)}onHxRequest(e){let t=o(e);t&&this.#s.enqueue(t)}};i(document,u.onHxRequest);export{i as connect,a as disconnect,u as hx};
